      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        document.documentElement.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
        localStorage.removeItem('bitage-theme');
      } else {
        document.documentElement.setAttribute('data-theme', mode);
        localStorage.setItem('bitage-theme', mode);
      }
    }

    // Media controls demo
    let playing = false; let prog = 35; let timer;
    const bar = document.getElementById('prog');
    const playBtn = document.getElementById('play');
    function tick(){ prog = Math.min(100, prog + 1); bar.style.width = prog + '%'; if(prog>=100) {clearInterval(timer); playing=false; playBtn.textContent='Play';}}
    playBtn.addEventListener('click', ()=>{
      playing = !playing;
      playBtn.textContent = playing ? 'Pause' : 'Play';
      clearInterval(timer);
      if(playing) timer = setInterval(tick, 300);
    });

    // Composer send
    document.getElementById('send').addEventListener('click', ()=>{
      const input = document.getElementById('composer');
      const text = input.value.trim();
      if(!text) return;
      const div = document.createElement('div');
      div.className='msg me';
      div.innerHTML = `<div style=\"color:var(--muted);font-size:12px;margin-bottom:4px\">You</div>${text}`;
      messages.appendChild(div);
      input.value='';
      content.scrollTop = content.scrollHeight;
    });

    // Sidebar view switcher
    const views = ['Chats','Communities','Friends','Settings'];
    function renderSidebarTabs(){
      const groups = [
        {title:'Navigate', items: views.map(v=>({id:'view:'+v, label:v}))}
      ];
      const wrapper = document.createElement('div');
      wrapper.className='nav';
      wrapper.innerHTML = '';
      // replace nav with dynamic loader
      nav.innerHTML='';
      const section = document.createElement('h4'); section.textContent='Views'; nav.appendChild(section);
      views.forEach(v=>{
        const it = document.createElement('div'); it.className='item'; it.innerHTML=`<span class='pill'>${v[0]}</span><span>${v}</span>`;
        it.addEventListener('click', ()=>{ renderNav(v); [...nav.querySelectorAll('.item')].forEach(i=>i.classList.remove('active')); it.classList.add('active'); });
        nav.appendChild(it);
      });
    }

    // Theme toggle button
    document.getElementById('toggleTheme').addEventListener('click', ()=>{
      const cur = document.documentElement.getAttribute('data-theme');
      setTheme(cur==='dark'?'light':'dark');
    });

    // Search filter
    document.getElementById('search').addEventListener('input', (e)=>{
      const q = e.target.value.toLowerCase();
      [...nav.querySelectorAll('.item')].forEach(el=>{
        const txt = el.textContent.toLowerCase();
        el.style.display = txt.includes(q) ? '' : 'none';
      });
    });

    // Init
    const saved = localStorage.getItem('bitage-theme');
    if(saved) setTheme(saved);
    renderRail();
    renderSidebarTabs();
    renderNav('Chats');
    openThread('general', '#general');
  </script>
</body>
</html>
